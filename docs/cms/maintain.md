---
title: 系统维护
---

**下方课件区域方向键控制翻页，`f` 键全屏。**

<iframe src="./slideshow.html" frameborder=0 width=800 height=450></iframe>

## 文件记录详细介绍

### 文件记录头

| 偏移 | 字段长度 | 含义                        |
| ---- | -------- | --------------------------- |
| 0x00 | 4        | MFT 记录标志-FILE           |
| 0x04 | 2        | 更新序列号偏移              |
| 0x06 | 2        | 更新序列号的大小            |
| 0x08 | 8        | 日志文件序列号对应\$LogFile |
| 0x10 | 2        | 序列号                      |
| 0x12 | 2        | 硬链接数量                  |
| 0x14 | 2        | 第一个属性的偏移            |
| 0x16 | 2        | 标记                        |
| 0x18 | 4        | 文件记录实际长度            |
| 0x1C | 4        | 文件记录分配长度            |
| 0x20 | 8        | 基本文件记录中的文件索引号  |
| 0x28 | 2        | 下一属性 ID                 |
| 0x2A | 2        | 边界                        |
| 0x2C | 4        | 文件记录参考号              |
| 0x30 | 2        | 更新序列号                  |
| 0x32 | 4        | 更新数组                    |

注：0x16 的标记，0x00 表示文件被删除，0x01 表示文件未删除，0x03 表示目录被删除，0x04 表示目录未删除。

source: https://docs.microsoft.com/en-us/windows/desktop/devnotes/file-record-segment-header

### 属性头

| 偏移 | 字段长度 | 含义                     |
| ---- | -------- | ------------------------ |
| 0x00 | 4        | 属性类型                 |
| 0x04 | 4        | 包括属性头在内的属性长度 |
| 0x08 | 1        | 是否是常驻属性           |
| 0x09 | 1        | 属性名的长度             |
| 0x0A | 2        | 属性名的偏移             |
| 0x0C | 2        | 压缩、加密、稀疏标志     |
| 0x0E | 2        | 属性 ID                  |
| 0x10 | 4        | 属性体的长度 L           |
| 0x14 | 2        | 属性体的开始偏移         |
| 0x16 | 1        | 索引标志                 |
| 0x17 | 1        | 无意义                   |
| 0x18 | L        | 属性体                   |

### 常见属性-标准信息-0x10

属性保存在 \$MFT 的文件记录中，称为常驻属性，保存在别的位置称为非常驻属性。

| 偏移 | 字段长度 | 含义         |
| ---- | -------- | ------------ |
| 0x00 | 8        | 文件创建时间 |
| 0x08 | 8        | 文件修改时间 |
| 0x10 | 8        | MFT 修改时间 |
| 0x18 | 8        | 文件访问时间 |
| 0x20 | 4        | 传统文件属性 |
| 0x24 | 4        | 最大版本数   |
| 0x28 | 4        | 版本数       |
| 0x2C | 4        | 分类 ID      |
| 0x30 | 4        | 所有者 ID    |
| 0x34 | 4        | 安全 ID      |
| 0x38 | 8        | 配额使用情况 |
| 0x40 | 8        | 更新序列号   |

注：0x20 的属性，0x0001 表示只读文件，0x0002 表示隐藏文件，0x0004 表示系统文件，还有其他属性。

### 常见属性-文件名-0x30

| 偏移 | 字段长度 | 含义                     |
| ---- | -------- | ------------------------ |
| 0x00 | 8        | 父目录文件参考号         |
| 0x08 | 8        | 文件创建时间             |
| 0x10 | 8        | 文件修改时间             |
| 0x18 | 8        | MFT 修改时间             |
| 0x20 | 8        | 文件访问时间             |
| 0x28 | 8        | 文件分配大小             |
| 0x30 | 8        | 文件实际大小             |
| 0x38 | 4        | 标志，目录、压缩、隐藏等 |
| 0x3C | 4        | 扩展属性                 |
| 0x40 | 1        | 文件名长度 L             |
| 0x41 | 1        | 文件命名空间             |
| 0x42 | 2L       | Unicode 文件名           |

注：0x41 的文件命名空间，0x01 是 NTFS 命名，0x02 是 DOS 命名。

### 常见属性-数据-0x80

文件大小较小时，数据是常驻属性，属性头后面就是文件数据。文件较大时，数据是非常驻属性。非常驻属性头的 0x20 偏移开始 2 字节是属性的开始偏移。属性对应 `Data Run List` 其含义如下：

![dataRunList](/img/data_run_list.jpg)

## 作业

<b style='color:red;font-size:2em;'>[作业链接](https://classroom.github.com/a/ehkDp7_w)</b>

**注: 本次作业会自动生成一个空的仓库，里面没有 `img` 文件夹也没有 `README.md` 文件。同学们需要先 clone 一个空仓库，再自行创建这些文件或目录。**

### 所需工具下载

本次作业需要 winhex 来完成十六进制文件查看与内容提取。

校园网访问: [校内 FTP 下载](http://202.205.24.235/ftp/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AE%89%E5%85%A8%E4%B8%8E%E7%BB%B4%E6%8A%A4/software/winhex.zip)

非校园网点击: [官网下载](http://www.x-ways.net/winhex.zip)

### 作业要求

下载并解压 winhex ，通过 winhex 观察自己学号对应的图片文件，找到藏在其中的压缩包；选中压缩包部分的所有十六进制内容，利用 winhex 的 `Edit` -> `Copy Block` -> `Into New File` 功能提取出压缩包；解压压缩包并找到 flag 。

完成并记录以上过程，提交内容包括实验报告和找到的 flag 图片。

Tips: 压缩包的文件开头为连续4个字节，其值为 `50` `4B` `03` `04` ，可利用 winhex 的 `Find Hex Values` 功能查找。

### 图片文件下载

[2019302120132](./homeworks/2019302120132.png)
[2020212063001](./homeworks/2020212063001.png)
[2020212063005](./homeworks/2020212063005.png)
[2020212063006](./homeworks/2020212063006.png)
[2020212063009](./homeworks/2020212063009.png)
[2020212063011](./homeworks/2020212063011.png)
[2020212063013](./homeworks/2020212063013.png)
[2020212063015](./homeworks/2020212063015.png)
[2020212063017](./homeworks/2020212063017.png)
[2020212063020](./homeworks/2020212063020.png)
[2020212063021](./homeworks/2020212063021.png)
[2020212063024](./homeworks/2020212063024.png)
[2020212063025](./homeworks/2020212063025.png)
[2020212063028](./homeworks/2020212063028.png)
[2020212063029](./homeworks/2020212063029.png)
[2020212063032](./homeworks/2020212063032.png)
[2020212063034](./homeworks/2020212063034.png)
[2020212063036](./homeworks/2020212063036.png)
[2020212063038](./homeworks/2020212063038.png)
[2020212063039](./homeworks/2020212063039.png)
[2020212063041](./homeworks/2020212063041.png)
[2020212063044](./homeworks/2020212063044.png)
[2020212063045](./homeworks/2020212063045.png)
[2020212063047](./homeworks/2020212063047.png)
[2020212063050](./homeworks/2020212063050.png)
[2020212063051](./homeworks/2020212063051.png)
[2020212063053](./homeworks/2020212063053.png)
[2020212063055](./homeworks/2020212063055.png)
[2020212063056](./homeworks/2020212063056.png)
[2020212063058](./homeworks/2020212063058.png)
[2020212063059](./homeworks/2020212063059.png)
[2019302120116](./homeworks/2019302120116.png)
[2020212063002](./homeworks/2020212063002.png)
[2020212063003](./homeworks/2020212063003.png)
[2020212063004](./homeworks/2020212063004.png)
[2020212063007](./homeworks/2020212063007.png)
[2020212063008](./homeworks/2020212063008.png)
[2020212063010](./homeworks/2020212063010.png)
[2020212063012](./homeworks/2020212063012.png)
[2020212063014](./homeworks/2020212063014.png)
[2020212063016](./homeworks/2020212063016.png)
[2020212063018](./homeworks/2020212063018.png)
[2020212063019](./homeworks/2020212063019.png)
[2020212063022](./homeworks/2020212063022.png)
[2020212063023](./homeworks/2020212063023.png)
[2020212063026](./homeworks/2020212063026.png)
[2020212063027](./homeworks/2020212063027.png)
[2020212063030](./homeworks/2020212063030.png)
[2020212063031](./homeworks/2020212063031.png)
[2020212063033](./homeworks/2020212063033.png)
[2020212063035](./homeworks/2020212063035.png)
[2020212063037](./homeworks/2020212063037.png)
[2020212063040](./homeworks/2020212063040.png)
[2020212063042](./homeworks/2020212063042.png)
[2020212063043](./homeworks/2020212063043.png)
[2020212063046](./homeworks/2020212063046.png)
[2020212063048](./homeworks/2020212063048.png)
[2020212063049](./homeworks/2020212063049.png)
[2020212063052](./homeworks/2020212063052.png)
[2020212063054](./homeworks/2020212063054.png)
[2020212063057](./homeworks/2020212063057.png)
[2020212063060](./homeworks/2020212063060.png)
